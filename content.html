<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex - Контент</title>
    <link rel="preload" href="partials/main.html" as="fetch" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative&family=Roboto&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Roboto', sans-serif; line-height: 1.6; color: #d0d0d0; overflow-x: hidden; }
        /* Все остальные стили остаются без изменений */
    </style>
</head>
<body>
    <div class="sidebar">
        <!-- Сайдбар без изменений -->
    </div>
    <div class="main-content">
        <div id="content-container">
            <div class="loading-indicator">
                <p>Загрузка контента...</p>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const maxAttempts = 10;
            let attempts = 0;
            
            const tryLoadContent = () => {
                if (document.getElementById('content-container')) {
                    const urlParams = new URLSearchParams(window.location.search);
                    loadContent(urlParams.get('page') || 'main');
                } else if (attempts < maxAttempts) {
                    attempts++;
                    setTimeout(tryLoadContent, 50);
                } else {
                    console.error('Контейнер контента не найден');
                    setTimeout(() => window.location.reload(), 300);
                }
            };
            
            const loadContent = (page) => {
                const container = document.getElementById('content-container');
                container.innerHTML = '<div class="loading-indicator"><p>Загрузка...</p></div>';
                
                fetch(`partials/${page}.html`)
                    .then(response => {
                        if (!response.ok) throw new Error('Страница не найдена');
                        return response.text();
                    })
                    .then(html => {
                        container.innerHTML = html;
                        updateActiveButton(page);
                        history.pushState({page}, null, `?page=${page}`);
                    })
                    .catch(err => {
                        console.error(err);
                        container.innerHTML = `
                            <div class="error-message">
                                <h3>Ошибка загрузки</h3>
                                <p>${err.message}</p>
                                <button class="retry-btn" onclick="loadContent('${page}')">Повторить</button>
                                <button class="home-btn" onclick="loadContent('main')">На главную</button>
                            </div>
                        `;
                    });
            };
            
            tryLoadContent();
        });
    </script>
</body>
</html>