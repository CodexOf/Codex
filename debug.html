<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex - –û—Ç–ª–∞–¥–∫–∞</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #2c3e50; 
            color: #ecf0f1;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: #34495e; 
            padding: 20px; 
            border-radius: 10px;
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            cursor: pointer; 
            background: #3498db; 
            color: white; 
            border: none; 
            border-radius: 5px;
        }
        button:hover { background: #2980b9; }
        .danger { background: #e74c3c !important; }
        .danger:hover { background: #c0392b !important; }
        pre { 
            background: #2c3e50; 
            padding: 15px; 
            border-radius: 5px; 
            white-space: pre-wrap; 
            overflow-x: auto;
        }
        .success { color: #2ecc71; }
        .error { color: #e74c3c; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –û—Ç–ª–∞–¥–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Codex</h1>
        
        <div>
            <button onclick="showAllData()">üìä –ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="testHashFunction()">üîë –¢–µ—Å—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è</button>
            <button onclick="clearAllData()" class="danger">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            <button onclick="createTestUser()">üë§ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        </div>
        
        <div id="output"></div>
    </div>

    <script src="js/auth-local.js"></script>
    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            output.appendChild(div);
            output.scrollTop = output.scrollHeight;
        }

        function showAllData() {
            log('=== –î–ê–ù–ù–´–ï –°–ò–°–¢–ï–ú–´ ===');
            
            const users = localStorage.getItem('codex_users');
            const events = localStorage.getItem('codex_events');
            const currentUser = localStorage.getItem('codex_currentUser');
            const loginTime = localStorage.getItem('codex_loginTime');
            
            log(`<pre>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: ${users || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</pre>`);
            log(`<pre>–°–æ–±—ã—Ç–∏—è: ${events || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</pre>`);
            log(`<pre>–¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</pre>`);
            log(`<pre>–í—Ä–µ–º—è –≤—Ö–æ–¥–∞: ${loginTime || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}</pre>`);
            
            if (users) {
                try {
                    const usersArray = JSON.parse(users);
                    log(`–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${usersArray.length}`, 'success');
                } catch (e) {
                    log('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ' + e.message, 'error');
                }
            }
        }

        function testHashFunction() {
            log('=== –¢–ï–°–¢ –•–ï–®–ò–†–û–í–ê–ù–ò–Ø ===');
            
            const testPasswords = ['123456', 'password', 'test123', 'admin'];
            
            testPasswords.forEach(password => {
                const hash = window.localAuthManager.hashPassword(password);
                log(`–ü–∞—Ä–æ–ª—å: "${password}" ‚Üí –•–µ—à: "${hash}"`);
            });
            
            // –¢–µ—Å—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
            const testPassword = 'test123';
            const hash1 = window.localAuthManager.hashPassword(testPassword);
            const hash2 = window.localAuthManager.hashPassword(testPassword);
            
            if (hash1 === hash2) {
                log(`‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ: "${testPassword}" –≤—Å–µ–≥–¥–∞ –¥–∞–µ—Ç "${hash1}"`, 'success');
            } else {
                log(`‚ùå –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ: "${hash1}" != "${hash2}"`, 'error');
            }
        }

        function clearAllData() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Å–æ–±—ã—Ç–∏—è?')) {
                localStorage.removeItem('codex_users');
                localStorage.removeItem('codex_events');
                localStorage.removeItem('codex_currentUser');
                localStorage.removeItem('codex_loginTime');
                
                log('üóëÔ∏è –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—á–∏—â–µ–Ω—ã', 'success');
                log('–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–Ω–æ–≤–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è');
            }
        }

        async function createTestUser() {
            const username = 'testuser';
            const password = '123456';
            
            log(`–°–æ–∑–¥–∞—é —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: "${username}" —Å –ø–∞—Ä–æ–ª–µ–º "${password}"`);
            
            const result = await window.localAuthManager.register(username, password);
            
            if (result.success) {
                log('‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ', 'success');
                log(`ID: ${result.user.id}, Username: ${result.user.username}`);
                
                // –í—ã—Ö–æ–¥–∏–º –∏–∑ —Å–∏—Å—Ç–µ–º—ã
                window.localAuthManager.currentUser = null;
                localStorage.removeItem('codex_currentUser');
                localStorage.removeItem('codex_loginTime');
                
                log('–¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –∫–∞–∫ testuser / 123456');
            } else {
                log('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + result.error, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            log('üîß –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            showAllData();
        });
    </script>
</body>
</html>
